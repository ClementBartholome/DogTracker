@page "/dog/{DogId:int}/walk"
@inject ILocationService LocationService
@inject IDogService DogService
@inject IJSRuntime JSRuntime
@using DogTracker.Interfaces
@rendermode InteractiveServer

<div class="container mx-auto px-4">
    <div class="bg-white rounded-lg shadow p-4 mb-4">
        <h1 class="text-2xl font-bold mb-4">Suivi de promenade</h1>

        @if (!isTracking)
        {
            <MudButton OnClick="StartWalk" Color="Color.Primary" Variant="Variant.Filled"
                       class="w-full text-white font-bold py-3 px-4 rounded-lg mb-4">
                Démarrer la promenade
            </MudButton>
        }
        else
        {
            <div class="space-y-4">
                <div class="text-center">
                    <p class="text-xl">Durée: @GetFormattedDuration()</p>
                    <p class="text-lg">Distance: @(currentDistance.ToString("F2")) km</p>
                </div>

                <MudButton OnClick="StopWalk" Color="Color.Primary" Variant="Variant.Filled"
                           class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg">
                    Terminer la promenade
                </MudButton>
            </div>
        }
    </div>

    <div id="map" style="height: 600px;" class="mb-4 rounded-lg w-100"></div>

    @if (walkHistory?.Any() == true)
    {
        <div class="bg-white rounded-lg shadow p-4">
            <h2 class="text-xl font-bold mb-4">Historique des Promenades</h2>
            <div class="space-y-3">
                @foreach (var walk in walkHistory.OrderByDescending(w => w.StartTime))
                {
                    <div class="border-b pb-2">
                        <p class="font-semibold">@walk.StartTime.ToString("dd/MM/yyyy HH:mm")</p>
                        <div class="flex justify-between text-gray-600">
                            <span>@walk.Distance.ToString("F2") km</span>
                            <span>@((walk.EndTime - walk.StartTime).TotalMinutes.ToString("F0")) min</span>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>